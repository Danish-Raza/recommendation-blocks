var blockData = {
  "Other Role-Playing Games": [
    {
      "discount": "",
      "handle": "my-time-at-portia-xb1",
      "clip":"",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/My_Time_at_Portia_Xb1_Cov.jpg?v=1592981794",
      "price": "$5.00",
      "product_id": 454591,
      "short_text":"lorem ipsum",
      "long_text":"Shoot enemies and gather amazing loot to upgrade and customize your character as you see fit.",
      "title": "My Time at Portia"
    },
    {
      "discount": "",
      "handle": "ni-no-kuni-2-digital-princes-edition-win",
      "clip":"https://vod-progressive.akamaized.net/exp=1599041105~acl=%2A%2F403092428.mp4%2A~hmac=5391b27096f7cd00d736a7d7e4999a760e2fc44e0284cfd0031a24ad0534ba4c/vimeo-prod-skyfire-std-us/01/2219/5/136097569/403092428.mp4?filename=Car+Racing+-+371.mp4",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/Ni_no_Kuni_II_win_prince_cov.png?v=1592984299",
      "product_id": 289742,
      "price": "$10.00",
      "title": "Ni no Kuni II: Revenant Kingdom - Digital Prince's Edition"
    },
    {
      "discount": "",
      "handle": "atelier-lulua-the-scion-of-arland-digital-deluxe-edition-win",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/Atelier_Lulua_The_Scion_of_Arland_ps4_win_ns_deluxe_cov_601d6f28-39b5-4f7d-8738-c085b3560765.jpg?v=1592984407",
      "product_id": 681153,
      "price": "$15.00",
      "clip":"",
      "title": "Atelier Lulua: The Scion of Arland - Digital Deluxe Edition"
    },
    {
      "discount": "",
      "handle": "bless-online-win",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/BLESS_ONLINE_win_cov.jpg?v=1592984940",
      "price": "$5.00",
     "clip":"https://vod-progressive.akamaized.net/exp=1599041105~acl=%2A%2F403092428.mp4%2A~hmac=5391b27096f7cd00d736a7d7e4999a760e2fc44e0284cfd0031a24ad0534ba4c/vimeo-prod-skyfire-std-us/01/2219/5/136097569/403092428.mp4?filename=Car+Racing+-+371.mp4",
      "product_id": 200504,
      "title": "BLESS ONLINE"
    },
    {
      "discount": "",
      "handle": "atelier-lulua-the-scion-of-arland-digital-deluxe-edition-win",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/Atelier_Lulua_The_Scion_of_Arland_ps4_win_ns_deluxe_cov_601d6f28-39b5-4f7d-8738-c085b3560765.jpg?v=1592984407",
      "price": "$20.00",
      "product_id": 681155,
     "clip":"https://vod-progressive.akamaized.net/exp=1599041105~acl=%2A%2F403092428.mp4%2A~hmac=5391b27096f7cd00d736a7d7e4999a760e2fc44e0284cfd0031a24ad0534ba4c/vimeo-prod-skyfire-std-us/01/2219/5/136097569/403092428.mp4?filename=Car+Racing+-+371.mp4",
      "title": "Atelier Lulua: The Scion of Arland - Digital Deluxe Edition"
    },
    {
      "discount": "",
      "handle": "bless-online-win",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/BLESS_ONLINE_win_cov.jpg?v=1592984940",
      "price": "$5.00",
      "product_id": 200506,
     "clip":"https://vod-progressive.akamaized.net/exp=1599041105~acl=%2A%2F403092428.mp4%2A~hmac=5391b27096f7cd00d736a7d7e4999a760e2fc44e0284cfd0031a24ad0534ba4c/vimeo-prod-skyfire-std-us/01/2219/5/136097569/403092428.mp4?filename=Car+Racing+-+371.mp4",
      "title": "BLESS ONLINE"
    }
  ],
  "Other users like you also bought": [
    {
      "discount": "",
      "handle": "agents-of-mayhem-xb1",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/game_cover_688d87af2ef876214d649b588469b7af.jpg?v=1592985340",
      "price": "$5.00",
      "product_id": "VGSXB1-1397",
      "short_text":"lorem ipsum",
      "long_text":"Shoot enemies and gather amazing loot to upgrade and customize your character as you see fit.",
      "title": "Agents of Mayhem"
    },
    {
      "discount": "",
      "handle": "days-gone-digital-deluxe-edition-ps4",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/Days-Gone-Digital-Deluxe-Edition-ps4cvr.jpg?v=1592981531",
      "price": "",
      "product_id": "VGSPS4-3.18",
      "short_text":"lorem ipsum",
      "long_text":"Shoot enemies and gather amazing loot to upgrade and customize your character as you see fit.",
      "title": "Days Gone: Digital Deluxe Edition"
    },
    {
      "discount": "10%",
      "handle": "ace-combat-7-ps4",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/Ace_Combat_7_PS4_Cov.png?v=1592981616",
      "price": "$10.00",
      "product_id": "VGSPS4-69",
      "title": "Ace Combat 7: Skies Unknown"
    },
    {
      "discount": "5%",
      "handle": "days-gone-collectors-edition-ps4",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/Days_Gone_CE_PS4_Cov.jpg?v=1592981533",
      "price": "$5.00",
      "product_id": "VGSPS4-3.210",
      "title": "Days Gone: Collector’s Edition"
    },
    {
      "discount": "",
      "handle": "agents-of-mayhem-xb1",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/game_cover_688d87af2ef876214d649b588469b7af.jpg?v=1592985340",
      "price": "$5.00",
      "product_id": "VGSXB1-13911",
      "title": "Agents of Mayhem"
    },
    {
      "discount": "",
      "handle": "days-gone-digital-deluxe-edition-ps4",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/Days-Gone-Digital-Deluxe-Edition-ps4cvr.jpg?v=1592981531",
      "price": "",
      "product_id": "VGSPS4-3.112",
      "title": "Days Gone: Digital Deluxe Edition"
    },
    {
      "discount": "10%",
      "handle": "ace-combat-7-ps4",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/Ace_Combat_7_PS4_Cov.png?v=1592981616",
      "price": "$10.00",
      "product_id": "VGSPS4-613",
      "title": "Ace Combat 7: Skies Unknown"
    },
    {
      "discount": "5%",
      "handle": "days-gone-collectors-edition-ps4",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/Days_Gone_CE_PS4_Cov.jpg?v=1592981533",
      "price": "$5.00",
      "product_id": "VGSPS4-3.214",
      "title": "Days Gone: Collector’s Edition"
    },
    {
      "discount": "",
      "handle": "agents-of-mayhem-xb1",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/game_cover_688d87af2ef876214d649b588469b7af.jpg?v=1592985340",
      "price": "$5.00",
      "product_id": "VGSXB1-13915",
      "title": "Agents of Mayhem"
    },
    {
      "discount": "",
      "handle": "days-gone-digital-deluxe-edition-ps4",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/Days-Gone-Digital-Deluxe-Edition-ps4cvr.jpg?v=1592981531",
      "price": "",
      "product_id": "VGSPS4-3.116",
      "title": "Days Gone: Digital Deluxe Edition"
    },
    {
      "discount": "10%",
      "handle": "ace-combat-7-ps4",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/Ace_Combat_7_PS4_Cov.png?v=1592981616",
      "price": "$10.00",
      "product_id": "VGSPS4-617",
      "title": "Ace Combat 7: Skies Unknown"
    },
    {
      "discount": "5%",
      "handle": "days-gone-collectors-edition-ps4",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/Days_Gone_CE_PS4_Cov.jpg?v=1592981533",
      "price": "$5.00",
      "product_id": "VGSPS4-3.218",
      "title": "Days Gone: Collector’s Edition"
    }
  ],
  "Other Role-Playing Game": [
    {
      "discount": "",
      "on_sale":true,
      "handle": "my-time-at-portia-xb1",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/My_Time_at_Portia_Xb1_Cov.jpg?v=1592981794",
      "screenshots": [
        "https://s3.amazonaws.com/gameopedia_covers/screenshots/1431578/10e8527c24f965e91eb1047fec51dabd_full480.jpg",
        "https://s3.amazonaws.com/gameopedia_covers/screenshots/1431577/43cc974f010cdbbcd83f3af0d4ba164a_full480.jpg",
        "https://s3.amazonaws.com/gameopedia_covers/screenshots/2225637/6ef02f613623b7800da742ce520224ad_full480.jpg",
        "https://s3.amazonaws.com/gameopedia_covers/screenshots/1431580/5742bbae7a1807aa2937436f35a0dc0c_full480.jpg"
      ],
      "price": "$5.00",
      "product_id": 4545919,
      "short_text":"lorem ipsum",
      "long_text":"Shoot enemies and gather amazing loot to upgrade and customize your character as you see fit.",
      "title": "My Time at Portia"
    },
    {
      "discount": "",
      "handle": "ni-no-kuni-2-digital-princes-edition-win",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/Ni_no_Kuni_II_win_prince_cov.png?v=1592984299",
      "screenshots": [
        "https://s3.amazonaws.com/gameopedia_covers/screenshots/1431578/10e8527c24f965e91eb1047fec51dabd_full480.jpg",
        "https://s3.amazonaws.com/gameopedia_covers/screenshots/1431577/43cc974f010cdbbcd83f3af0d4ba164a_full480.jpg",
        "https://s3.amazonaws.com/gameopedia_covers/screenshots/2225637/6ef02f613623b7800da742ce520224ad_full480.jpg",
        "https://s3.amazonaws.com/gameopedia_covers/screenshots/1431580/5742bbae7a1807aa2937436f35a0dc0c_full480.jpg"
      ],
      "price": "$10.00",
      "product_id": 2897420,
      "short_text":"lorem ipsum",
      "long_text":"Shoot enemies and gather amazing loot to upgrade and customize your character as you see fit.",
      "title": "Ni no Kuni II: Revenant Kingdom - Digital Prince's Edition"
    }
  ],
  "Frequently bought together": [
    {
      "discount": "",
      "handle": "my-time-at-portia-xb1",
      "clip":"",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/My_Time_at_Portia_Xb1_Cov.jpg?v=1592981794",
      "price": "$5.00",
      "product_id": 45459133,
      "short_text":"lorem ipsum",
      "long_text":"Shoot enemies and gather amazing loot to upgrade and customize your character as you see fit.",
      "title": "My Time at Portia"
    },
    {
      "discount": "",
      "handle": "ni-no-kuni-2-digital-princes-edition-win",
      "clip":"https://vod-progressive.akamaized.net/exp=1599041105~acl=%2A%2F403092428.mp4%2A~hmac=5391b27096f7cd00d736a7d7e4999a760e2fc44e0284cfd0031a24ad0534ba4c/vimeo-prod-skyfire-std-us/01/2219/5/136097569/403092428.mp4?filename=Car+Racing+-+371.mp4",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/Ni_no_Kuni_II_win_prince_cov.png?v=1592984299",
      "product_id": 28974224,
      "price": "$10.00",
      "title": "Ni no Kuni II: Revenant Kingdom - Digital Prince's Edition"
    },
    {
      "discount": "",
      "handle": "atelier-lulua-the-scion-of-arland-digital-deluxe-edition-win",
      "img_src": "https://cdn.shopify.com/s/files/1/0280/6457/9655/products/Atelier_Lulua_The_Scion_of_Arland_ps4_win_ns_deluxe_cov_601d6f28-39b5-4f7d-8738-c085b3560765.jpg?v=1592984407",
      "product_id": 68115325,
      "price": "$15.00",
      "clip":"",
      "title": "Atelier Lulua: The Scion of Arland - Digital Deluxe Edition"
    }
  ]
}
const cardConfig = {
  "template-1": {
    card:{ height: 140, width: 266, margin: 15, extraWidth: 100}
  },
  "template-2": {
    card:{ height: 140, width: 120, margin: 15, extraWidth: 240}
  },
  "template-3": {
    card:{ height: 358, width: 536, margin: 15, extraWidth: 100}
  },
  "template-4": {
    card:{ height: 140, width: 266, margin: 15, extraWidth: 100}
  },
}

const scrollHandler = (containerIndex,order,paginationIndex) => {
  let rcBlock = document.querySelector(`[data-container-index="${containerIndex}"]`);
  let availableWidht = window.screen.availWidth;
  let paginationBlock = document.querySelector(`#pagination-block${containerIndex}`);
  let itagRight =   document.querySelectorAll(".content-box")[containerIndex-1].querySelector(".fa-chevron-right");
  let itagleft =   document.querySelectorAll(".content-box")[containerIndex-1].querySelector(".fa-chevron-left");
  let bulletIndex =  Math.ceil(rcBlock.scrollLeft/availableWidht);
  if(order=="right") {
    rcBlock.scrollLeft -= availableWidht;
  } else if(order=="left") {
    rcBlock.scrollLeft += availableWidht;
  } else if (order == "move" && paginationBlock.querySelector("i.active")) {
    paginationBlock.querySelector("i.active").classList.remove("active");
    paginationBlock.querySelectorAll("i")[bulletIndex].classList.add("active");
  } else if(order=="click") {
    rcBlock.scrollLeft = availableWidht*paginationIndex;
  }
  if(paginationBlock.childElementCount == bulletIndex+1) {
    itagRight.style.color="grey";
    itagleft.style.color="black";
  } else if(rcBlock.scrollLeft == 0) {
    itagleft.style.color="grey";
    itagRight.style.color="black";
  } else {
    itagRight.style.color="black";
    itagleft.style.color="black";
  }
}

const paginationHandler = () => {
  let availableWidht = window.screen.availWidth;
  document.querySelectorAll(".content-box").forEach((block,index) => {
    let template = block.getAttribute("data-template");
    let noOfCards = block.getAttribute("data-no-of-cards");
    let requiredWidth = (cardConfig[template].card.width * noOfCards) + cardConfig[template].card.extraWidth;
    let noOfSildes = Math.ceil((requiredWidth/availableWidht));
    let bullet = "";
    let itagRight =  block.querySelector(".fa-chevron-right");
    let itagleft = block.querySelector(".fa-chevron-left");
    if(noOfSildes > 1) {
      for(let i=0 ; i < noOfSildes; i++) {
        bullet = bullet + `<i class="fa fa-circle ${i==0?"active":""}" aria-hidden="true" onclick="scrollHandler(${index+1},'click',${i})"></i>`
      }
    }
    itagleft.style.color="grey";
    if(noOfSildes == 1) {
      itagRight.style.display="none";
      itagleft.style.display="none";
    }
    document.getElementById(`pagination-block${index+1}`).innerHTML = bullet;
  });
}

window.onload = () => {
  var gameopediaRecommendationBlock = document.getElementById("gameopedia-recommendation-block");
  var index = 0;
  for (var recBlock in blockData) {
    index++;
    let template = `template-${index}`
    let noOfCards = blockData[recBlock].length;
    let block = recomendationBlock(blockData[recBlock], index, recBlock, template, noOfCards);
    gameopediaRecommendationBlock.innerHTML += block;
  }
  paginationHandler()
}

window.onresize = paginationHandler;

const playVideo = (video) => {
  video.play();
}

const pauseVideo = (video) => {
  video.load();
}

const addToCardHandler = (productId,order) => {
  if(order=="single") {

  } else if(order=="multi") {

  }
}

const recomendationBlock = (recData, index, recBlock, template, noOfCards) => {
  let cards = ""
  if (index == 1) {
    recData.forEach((record,index) => {
      cards+= `<div class="card">
      <div class="card-body"> 
        <video poster="${record.img_src}" id="bgvid${record.product_id}" playsinline muted loop  onmouseover="playVideo(bgvid${record.product_id})" onmouseleave="pauseVideo(bgvid${record.product_id})">
          <source src="${record.clip}">
        </video>  
        <div class="card-footer">
          ${record.price ? `<div class="price">${record.price}</div>`: ""}
          <i class="fa fa-shopping-cart" aria-hidden="true"></i>
        </div>
      </div>
      <div class="card-header">
        <div class="title">${record.title ? record.title : ""}</div>
        <div class="short-text">${record.short_text ? record.short_text : ""}</div>
        <div class="long-text">${record.long_text ? record.long_text : ""}</div>
      </div>
    </div>`
    });
  } else if (index == 2) {
    recData.forEach((record, index) => {
      cards += `<div class="card-wrapper">
      <div class="card-body">
        <div class="card-footer">
          <div class="long-text" style="color:white;text-align:center;padding:5px">${record.long_text ? record.long_text : ""}</div>
          <div style="display:flex;justify-content: center; width: 120px">
          <div class="price" style="color:#F8E71C">${record.price ? record.price :""}</div>
          <i class="fa fa-shopping-cart" aria-hidden="true"></i>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="box-art" style="background-image: url(${record.img_src});"></div>
      </div>
      <div class="short-text">${record.short_text ? record.short_text : ""}</div>
      <div class="title">${record.title}</div>
      </div>`
    });
  } else if(index == 3) {
    //  <i class="fa fa-chevron-left" aria-hidden="true" style="color:#E1A3A4"></i>
   // <i class="fa fa-chevron-right" aria-hidden="true" style="color:#E1A3A4"></i>
    recData.forEach((record, index) => {
      let screenshots = "";
      record.screenshots.forEach(element => {
        screenshots+= ` <div class="box-art" style="background-image: url(${element});"></div>`
      }); 
      cards += `<div class="card-wrapper" onmouseover="playVideo(bgvid${record.product_id})" onmouseleave="pauseVideo(bgvid${record.product_id})" >
      <canvas class="canvas"></canvas>
      <div class="card-body">
        <div class="card-header">
          <div class="box-art" style="background-image: url(${record.img_src});"></div>
          <div class="title">${record.title ? record.title : ""}</div>
          <div class="short-text">${record.short_text ? record.short_text : ""}</div>
          <div class="long-text">${record.long_text ? record.long_text : ""}</div>
        </div>
        <div class="card-footer">
          <div class="add-to-cart"><i class="fa fa-shopping-cart" aria-hidden="true" style="margin-right:5px;font-size:17px"></i></div> 
          ${record.price ? `<div class="right-section">${record.on_sale ?"<div class='on-sale'>ON SALE</div>" : ""}<div class="price">${record.price}</div></div>`: ""}
          ${screenshots != "" ? `<div class="screenshots-wrapper">
         
          <div class="screenshots">
            ${screenshots}
          </div>
        
          </div> `: ""}
        </div>
      </div>
      <div class="card">
        <video poster="${record.img_src}" id="bgvid${record.product_id}" playsinline muted loop>
          <source >
        </video>
      </div>
      </div>`
    });
  } else if(index == 4) {
    recData.forEach((record, index) => {
      cards += `<div class="card-wrapper">
      <div class="card-body">
        <div class="card-footer">
          <div class="long-text" style="color:white;text-align:center;padding:5px">${record.long_text ? record.long_text : ""}</div>
          <div style="display:flex;justify-content: center; width: 120px">
          </div>
        </div>
      </div>
      <div class="card">
        <div class="box-art" style="background-image: url(${record.img_src});"></div>
      </div>
      <div class="short-text">${record.short_text ? record.short_text : ""}</div>
      <div class="title">${record.title}</div>
      <div class="checkbox-container">
        <label class="checkbox-label">
            <input type="checkbox" checked value=${record.product_id}>
            <span class="checkbox-custom rectangular"></span>
        </label>
        <div class="price">${record.price ? record.price :""}</div>
      </div>
      </div>
      ${index != recData.length-1 ? '<div style="display:flex;align-items:center;font-weight:bold">+</div>' : ""}`
    });
    cards+='<div class="add-to-cart">ADD TO CART</div>'
  }
  return (
    `<div class="content-box ${template}" data-template="${template}" data-no-of-cards="${noOfCards}">
      <div class="content-title"> ${recBlock}</div>
      <div class="container-wrapper">
        <i class="fa fa-chevron-left" aria-hidden="true" onclick="scrollHandler(${index},'right')"></i>
        <div class="container" data-container-index="${index}" onscroll="scrollHandler(${index},'move')">
          ${cards}
        </div>
        <i class="fa fa-chevron-right" aria-hidden="true" onclick="scrollHandler(${index},'left')"></i>
      </div>
      <div class="pagination" id="pagination-block${index}"></div>
    </div>`
  )
}